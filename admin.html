<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">ğŸ” Admin Panel</a>

                <nav>
                    <ul>
                        <li><a href="index.html">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                        <li><button onclick="adminLogout()" class="btn btn-danger" style="padding: 0.5rem 1rem;">ØªØ³Ø¬ÙŠÙ„
                                Ø§Ù„Ø®Ø±ÙˆØ¬</button></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Login Section -->
    <section class="form-section" id="login-section">
        <div class="container">
            <div class="card" style="max-width: 500px; margin: 0 auto;">
                <div class="card-header text-center">
                    <h2 class="card-title">ğŸ”’ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù</h2>
                    <p>ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</p>
                </div>

                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="adminPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="adminPassword" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
                            required>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        Ø¯Ø®ÙˆÙ„
                    </button>
                </form>
            </div>
        </div>
    </section>

    <!-- Admin Dashboard -->
    <section class="form-section" id="admin-dashboard" style="display: none;">
        <div class="container">
            <div class="section-title">
                <h1>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
                <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª</p>
            </div>

            <!-- Statistics -->
            <div class="services-grid">
                <div class="service-card">
                    <span class="service-icon">ğŸ“¦</span>
                    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
                    <div class="service-price" id="admin-total-orders">0</div>
                </div>

                <div class="service-card">
                    <span class="service-icon">ğŸ†•</span>
                    <h3>Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</h3>
                    <div class="service-price" id="admin-new-orders">0</div>
                </div>

                <div class="service-card">
                    <span class="service-icon">â³</span>
                    <h3>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</h3>
                    <div class="service-price" id="admin-processing-orders">0</div>
                </div>

                <div class="service-card">
                    <span class="service-icon">âœ…</span>
                    <h3>Ù…ÙƒØªÙ…Ù„Ø©</h3>
                    <div class="service-price" id="admin-completed-orders">0</div>
                </div>
            </div>

            <!-- Filters -->
            <div class="card">
                <h3>ğŸ” ØªØµÙÙŠØ© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                    <div class="form-group" style="margin: 0;">
                        <label for="filterStatus">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</label>
                        <select id="filterStatus" class="form-control" onchange="filterOrders()">
                            <option value="">Ø§Ù„ÙƒÙ„</option>
                            <option value="New">Ø¬Ø¯ÙŠØ¯</option>
                            <option value="Processing">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                            <option value="Completed">Ù…ÙƒØªÙ…Ù„</option>
                            <option value="Cancelled">Ù…Ù„ØºÙŠ</option>
                        </select>
                    </div>

                    <div class="form-group" style="margin: 0;">
                        <label for="filterPayment">Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</label>
                        <select id="filterPayment" class="form-control" onchange="filterOrders()">
                            <option value="">Ø§Ù„ÙƒÙ„</option>
                            <option value="Pending">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                            <option value="Confirmed">Ù…Ø¤ÙƒØ¯</option>
                        </select>
                    </div>

                    <div class="form-group" style="margin: 0;">
                        <label for="filterService">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</label>
                        <select id="filterService" class="form-control" onchange="filterOrders()">
                            <option value="">Ø§Ù„ÙƒÙ„</option>
                            <option value="followers">Ù…ØªØ§Ø¨Ø¹ÙŠÙ†</option>
                            <option value="likes">Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª</option>
                            <option value="views">Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</option>
                            <option value="management">Ø¥Ø¯Ø§Ø±Ø© Ø­Ø³Ø§Ø¨Ø§Øª</option>
                        </select>
                    </div>

                    <div style="display: flex; align-items: flex-end;">
                        <button onclick="loadAllOrders()" class="btn btn-secondary" style="width: 100%;">
                            ØªØ­Ø¯ÙŠØ«
                        </button>
                    </div>
                </div>
            </div>

            <!-- Orders Table -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
                </div>

                <div id="admin-orders-loading" class="text-center">
                    <div class="spinner"></div>
                    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>
                </div>

                <div id="admin-orders-empty" style="display: none;" class="text-center">
                    <p style="color: var(--text-muted); padding: 2rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</p>
                </div>

                <div id="admin-orders-table" style="display: none;">
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                    <th>Ø§Ù„Ø®Ø¯Ù…Ø©</th>
                                    <th>Ø§Ù„Ø¨Ø§Ù‚Ø©</th>
                                    <th>Ø§Ù„Ø±Ø§Ø¨Ø·</th>
                                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                    <th>Ø§Ù„Ø¯ÙØ¹</th>
                                    <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</th>
                                    <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="admin-orders-tbody">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card">
                <h3>âš¡ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="flex gap-2" style="flex-wrap: wrap; margin-top: 1rem;">
                    <button onclick="exportOrders()" class="btn btn-secondary">ØªØµØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª (CSV)</button>
                    <button onclick="showPendingPayments()" class="btn btn-warning">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</button>
                    <button onclick="showNewOrders()" class="btn btn-primary">Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Order Details Modal (Simple) -->
    <div id="orderModal"
        style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 10000; overflow-y: auto;">
        <div class="container" style="padding: 2rem 0;">
            <div class="card" style="max-width: 600px; margin: 0 auto;">
                <div class="card-header">
                    <h2 class="card-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h2>
                    <button onclick="closeModal()" class="btn btn-secondary" style="float: left;">Ø¥ØºÙ„Ø§Ù‚</button>
                </div>
                <div id="orderModalContent">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2024 SMM Store Admin Panel. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="script.js"></script>
    <script>
        // Admin password (CHANGE THIS!)
        const ADMIN_PASSWORD = 'admin123';

        let allOrders = [];
        let filteredOrders = [];

        // Check if admin is logged in
        document.addEventListener('DOMContentLoaded', () => {
            if (isAdminLoggedIn()) {
                showDashboard();
                loadAllOrders();
            } else {
                showLogin();
            }
        });

        function isAdminLoggedIn() {
            return sessionStorage.getItem('adminLoggedIn') === 'true';
        }

        function showLogin() {
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('admin-dashboard').style.display = 'none';
        }

        function showDashboard() {
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('admin-dashboard').style.display = 'block';
        }

        // Handle admin login
        document.getElementById('adminLoginForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const password = document.getElementById('adminPassword').value;

            if (password === ADMIN_PASSWORD) {
                sessionStorage.setItem('adminLoggedIn', 'true');
                showDashboard();
                loadAllOrders();
            } else {
                showAlert('error', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
            }
        });

        function adminLogout() {
            sessionStorage.removeItem('adminLoggedIn');
            showLogin();
        }

        // Load all orders
        async function loadAllOrders() {
            const loadingDiv = document.getElementById('admin-orders-loading');
            const emptyDiv = document.getElementById('admin-orders-empty');
            const tableDiv = document.getElementById('admin-orders-table');

            loadingDiv.style.display = 'block';
            emptyDiv.style.display = 'none';
            tableDiv.style.display = 'none';

            try {
                allOrders = await getAllOrders();
                filteredOrders = [...allOrders];

                loadingDiv.style.display = 'none';

                if (allOrders.length === 0) {
                    emptyDiv.style.display = 'block';
                } else {
                    tableDiv.style.display = 'block';
                    displayOrders(filteredOrders);
                    updateAdminStatistics(allOrders);
                }
            } catch (error) {
                loadingDiv.style.display = 'none';
                showAlert('error', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª');
                console.error('Error loading orders:', error);
            }
        }

        function displayOrders(orders) {
            const tbody = document.getElementById('admin-orders-tbody');
            tbody.innerHTML = '';

            orders.forEach(order => {
                const row = document.createElement('tr');
                row.innerHTML = `
          <td><strong>${order.orderId}</strong></td>
          <td>${formatDate(order.timestamp)}</td>
          <td>
            <div>${order.userName}</div>
            <small style="color: var(--text-muted);">${order.userEmail}</small>
          </td>
          <td>${getServiceNameAr(order.serviceType)}</td>
          <td>${order.package}</td>
          <td><a href="${order.targetUrl}" target="_blank" style="color: var(--primary-light);">Ø±Ø§Ø¨Ø·</a></td>
          <td>${formatPrice(order.price)}</td>
          <td>${getPaymentMethodAr(order.paymentMethod)}</td>
          <td>${getStatusBadge(order.paymentStatus)}</td>
          <td>${getStatusBadge(order.orderStatus)}</td>
          <td>
            <select onchange="changeOrderStatus('${order.orderId}', this.value)" class="form-control" style="padding: 0.5rem; font-size: 0.9rem;">
              <option value="">ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©</option>
              <option value="New">Ø¬Ø¯ÙŠØ¯</option>
              <option value="Processing">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
              <option value="Completed">Ù…ÙƒØªÙ…Ù„</option>
              <option value="Cancelled">Ù…Ù„ØºÙŠ</option>
            </select>
            <button onclick="viewOrderDetails('${order.orderId}')" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.9rem; margin-top: 0.5rem; width: 100%;">
              Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
            </button>
          </td>
        `;
                tbody.appendChild(row);
            });
        }

        function updateAdminStatistics(orders) {
            const totalOrders = orders.length;
            const newOrders = orders.filter(o => o.orderStatus === 'New').length;
            const processingOrders = orders.filter(o => o.orderStatus === 'Processing').length;
            const completedOrders = orders.filter(o => o.orderStatus === 'Completed').length;

            document.getElementById('admin-total-orders').textContent = totalOrders;
            document.getElementById('admin-new-orders').textContent = newOrders;
            document.getElementById('admin-processing-orders').textContent = processingOrders;
            document.getElementById('admin-completed-orders').textContent = completedOrders;
        }

        async function changeOrderStatus(orderId, newStatus) {
            if (!newStatus) return;

            const success = await updateOrderStatus(orderId, newStatus);

            if (success) {
                loadAllOrders();
            }
        }

        function filterOrders() {
            const statusFilter = document.getElementById('filterStatus').value;
            const paymentFilter = document.getElementById('filterPayment').value;
            const serviceFilter = document.getElementById('filterService').value;

            filteredOrders = allOrders.filter(order => {
                const statusMatch = !statusFilter || order.orderStatus === statusFilter;
                const paymentMatch = !paymentFilter || order.paymentStatus === paymentFilter;
                const serviceMatch = !serviceFilter || order.serviceType === serviceFilter;

                return statusMatch && paymentMatch && serviceMatch;
            });

            displayOrders(filteredOrders);
        }

        function viewOrderDetails(orderId) {
            const order = allOrders.find(o => o.orderId === orderId);

            if (!order) return;

            const modalContent = document.getElementById('orderModalContent');
            modalContent.innerHTML = `
        <div style="padding: 1rem 0;">
          <h3>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${order.orderId}</h3>
          <hr style="border-color: var(--dark-border); margin: 1rem 0;">
          
          <div style="margin-bottom: 1rem;">
            <strong>Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${order.userName} (${order.userEmail})
          </div>
          
          <div style="margin-bottom: 1rem;">
            <strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${formatDate(order.timestamp)}
          </div>
          
          <div style="margin-bottom: 1rem;">
            <strong>Ø§Ù„Ø®Ø¯Ù…Ø©:</strong> ${getServiceNameAr(order.serviceType)}
          </div>
          
          <div style="margin-bottom: 1rem;">
            <strong>Ø§Ù„Ø¨Ø§Ù‚Ø©:</strong> ${order.package}
          </div>
          
          <div style="margin-bottom: 1rem;">
            <strong>Ø§Ù„ÙƒÙ…ÙŠØ©:</strong> ${order.quantity}
          </div>
          
          <div style="margin-bottom: 1rem;">
            <strong>Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù:</strong><br>
            <a href="${order.targetUrl}" target="_blank" style="color: var(--primary-light); word-break: break-all;">${order.targetUrl}</a>
          </div>
          
          <div style="margin-bottom: 1rem;">
            <strong>Ø§Ù„Ø³Ø¹Ø±:</strong> ${formatPrice(order.price)}
          </div>
          
          <div style="margin-bottom: 1rem;">
            <strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</strong> ${getPaymentMethodAr(order.paymentMethod)}
          </div>
          
          <div style="margin-bottom: 1rem;">
            <strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹:</strong> ${getStatusBadge(order.paymentStatus)}
          </div>
          
          <div style="margin-bottom: 1rem;">
            <strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨:</strong> ${getStatusBadge(order.orderStatus)}
          </div>
          
          ${order.screenshot ? `
            <div style="margin-bottom: 1rem;">
              <strong>ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„:</strong><br>
              <a href="${order.screenshot}" target="_blank" style="color: var(--primary-light);">Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©</a>
            </div>
          ` : ''}
          
          ${order.transactionRef ? `
            <div style="margin-bottom: 1rem;">
              <strong>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:</strong> ${order.transactionRef}
            </div>
          ` : ''}
        </div>
      `;

            document.getElementById('orderModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('orderModal').style.display = 'none';
        }

        function showPendingPayments() {
            document.getElementById('filterPayment').value = 'Pending';
            filterOrders();
        }

        function showNewOrders() {
            document.getElementById('filterStatus').value = 'New';
            filterOrders();
        }

        function exportOrders() {
            // Simple CSV export
            let csv = 'Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨,Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„Ø¹Ù…ÙŠÙ„,Ø§Ù„Ø¨Ø±ÙŠØ¯,Ø§Ù„Ø®Ø¯Ù…Ø©,Ø§Ù„Ø¨Ø§Ù‚Ø©,Ø§Ù„Ø³Ø¹Ø±,Ø§Ù„Ø¯ÙØ¹,Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹,Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨\n';

            filteredOrders.forEach(order => {
                csv += `${order.orderId},${formatDate(order.timestamp)},${order.userName},${order.userEmail},${getServiceNameAr(order.serviceType)},${order.package},${order.price},${getPaymentMethodAr(order.paymentMethod)},${order.paymentStatus},${order.orderStatus}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `orders_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();

            showAlert('success', 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        }

        function getPaymentMethodAr(method) {
            const methods = {
                'bank': 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ',
                'vodafone': 'ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´',
                'paypal': 'PayPal'
            };
            return methods[method] || method;
        }
    </script>
</body>

</html>